{"ast":null,"code":"import store from '@/store';\nimport { mapGetters } from 'vuex';\nexport default {\n  name: \"ComplaintList\",\n  computed: {\n    ...mapGetters(['Token', 'UserInfo', 'RoleType', 'HasUserInfo', 'ColumnType', \"UserId\"])\n  },\n  data() {\n    return {\n      where: {\n        UserId: store.getters.UserId\n      },\n      // 投诉表单数据\n      complaintForm: {\n        content: ''\n      },\n      // 表单验证规则\n      complaintRules: {\n        content: [{\n          required: true,\n          message: '请输入投诉内容',\n          trigger: 'blur'\n        }, {\n          min: 10,\n          message: '投诉内容至少10个字符',\n          trigger: 'blur'\n        }, {\n          max: 500,\n          message: '投诉内容最多500个字符',\n          trigger: 'blur'\n        }]\n      },\n      // 表格列定义\n      dataColum: [{\n        key: \"SId\",\n        title: \"流水编号\",\n        type: store.getters.ColumnType.SHORTTEXT,\n        width: 100\n      }, {\n        key: \"content\",\n        title: \"投诉内容\",\n        type: store.getters.ColumnType.SHORTTEXT,\n        width: 300,\n        formatter: (row, column, cellValue) => {\n          if (!cellValue) return '';\n          return cellValue.length > 30 ? cellValue.substring(0, 30) + '...' : cellValue;\n        }\n      }, {\n        key: \"AdminId\",\n        title: \"处理人\",\n        type: store.getters.ColumnType.SHORTTEXT,\n        width: 100,\n        formatter: (row, column, cellValue) => {\n          return cellValue || '未分配';\n        }\n      }, {\n        key: \"ComplaintStatus\",\n        title: \"处理状态\",\n        type: store.getters.ColumnType.SHORTTEXT,\n        width: 120,\n        formatter: (row, column, cellValue) => {\n          return this.getStatusText(cellValue);\n        }\n      }, {\n        key: \"Response\",\n        title: \"处理回复\",\n        type: store.getters.ColumnType.SHORTTEXT,\n        width: 200,\n        formatter: (row, column, cellValue) => {\n          if (!cellValue) return '暂无回复';\n          return cellValue.length > 20 ? cellValue.substring(0, 20) + '...' : cellValue;\n        }\n      }],\n      // 详情弹窗控制\n      detailDialogVisible: false,\n      // 当前查看的详情\n      currentDetail: {},\n      // 状态映射\n      statusMap: {\n        0: {\n          text: '待处理',\n          type: 'warning'\n        },\n        1: {\n          text: '处理中',\n          type: 'info'\n        },\n        2: {\n          text: '已处理',\n          type: 'success'\n        },\n        3: {\n          text: '已关闭',\n          type: 'danger'\n        }\n      }\n    };\n  },\n  created() {\n    // 可以在这里添加初始化逻辑\n  },\n  methods: {\n    // 返回上一个页面\n    goBack() {\n      this.$router.go(-1);\n    },\n    // 提交投诉\n    async submitComplaint() {\n      this.$refs.complaintFormRef.validate(async valid => {\n        if (!valid) {\n          this.$message.error('请填写正确的投诉内容');\n          return;\n        }\n        try {\n          const confirm = await this.$comm.ConfirmMessageBox({\n            content: \"确认提交投诉吗？提交后不可修改。\"\n          });\n          if (confirm) {\n            // 构建投诉数据\n            const complaintData = {\n              content: this.complaintForm.content\n              // UserId 会自动从Token获取，后端会处理\n            };\n            const {\n              Success,\n              Message\n            } = await this.$Post(\"/Complaint/CreateOrEdit\", complaintData);\n            if (Success) {\n              this.$message.success('投诉提交成功');\n              this.resetComplaintForm();\n              // 刷新表格\n              this.refreshTable();\n            } else {\n              this.$message.error(Message || '提交失败');\n            }\n          }\n        } catch (error) {\n          console.error('提交投诉失败:', error);\n          this.$message.error('提交失败，请稍后重试');\n        }\n      });\n    },\n    // 重置投诉表单\n    resetComplaintForm() {\n      this.$refs.complaintFormRef.resetFields();\n    },\n    // 刷新表格\n    refreshTable() {\n      if (this.$refs.ComplaintTable) {\n        this.$refs.ComplaintTable.Reload();\n      }\n    },\n    // 显示详情弹窗\n    async showDetail(row) {\n      try {\n        // 获取完整详情\n        const {\n          Data\n        } = await this.$Post(\"/Complaint/Get\", {\n          Id: row.Id || row.SId\n        });\n        if (Data) {\n          this.currentDetail = Data;\n          this.detailDialogVisible = true;\n        } else {\n          this.$message.warning('未找到投诉详情');\n        }\n      } catch (error) {\n        console.error('获取详情失败:', error);\n        this.$message.error('获取详情失败');\n      }\n    },\n    // 获取状态文本\n    getStatusText(status) {\n      return this.statusMap[status]?.text || '未知状态';\n    },\n    // 获取状态标签类型\n    getStatusType(status) {\n      return this.statusMap[status]?.type || 'info';\n    }\n  }\n};","map":{"version":3,"names":["store","mapGetters","name","computed","data","where","UserId","getters","complaintForm","content","complaintRules","required","message","trigger","min","max","dataColum","key","title","type","ColumnType","SHORTTEXT","width","formatter","row","column","cellValue","length","substring","getStatusText","detailDialogVisible","currentDetail","statusMap","text","created","methods","goBack","$router","go","submitComplaint","$refs","complaintFormRef","validate","valid","$message","error","confirm","$comm","ConfirmMessageBox","complaintData","Success","Message","$Post","success","resetComplaintForm","refreshTable","console","resetFields","ComplaintTable","Reload","showDetail","Data","Id","SId","warning","status","getStatusType"],"sources":["src/views/Front/ComplaintList.vue"],"sourcesContent":["<template>\r\n    <div class=\"app-container\">\r\n        <el-page-header class=\"card margin-top-lg\" @back=\"goBack\" :content=\"'我的投诉记录'\">\r\n        </el-page-header>\r\n\r\n        <!-- 投诉表单 -->\r\n        <el-card class=\"box-card margin-top-lg\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>我要投诉</span>\r\n            </div>\r\n            <div class=\"tb-body\">\r\n                <el-form ref=\"complaintFormRef\" :model=\"complaintForm\" :rules=\"complaintRules\" label-width=\"80px\">\r\n                    <el-form-item label=\"投诉内容\" prop=\"content\">\r\n                        <el-input \r\n                            v-model.trim=\"complaintForm.content\" \r\n                            type=\"textarea\" \r\n                            :rows=\"4\" \r\n                            placeholder=\"请输入您的投诉内容...\" \r\n                            :clearable=\"true\"\r\n                            maxlength=\"500\"\r\n                            show-word-limit\r\n                        ></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item>\r\n                        <el-button type=\"primary\" size=\"mini\" @click=\"submitComplaint\">提交投诉</el-button>\r\n                        <el-button size=\"mini\" @click=\"resetComplaintForm\">重置</el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 投诉记录表格 -->\r\n        <el-card class=\"box-card margin-top-lg\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>投诉记录</span>\r\n            </div>\r\n            \r\n            <PaginationTable \r\n                ref=\"ComplaintTable\" \r\n                url=\"/Complaint/List\" \r\n                :column=\"dataColum\" \r\n                :where=\"where\"\r\n            >\r\n                <template v-slot:header>\r\n                    <el-button \r\n                        type=\"info\" \r\n                        size=\"mini\" \r\n                        plain \r\n                        icon=\"el-icon-refresh\"\r\n                        @click=\"refreshTable\"\r\n                    >刷新</el-button>\r\n                </template>\r\n                \r\n                <template v-slot:row-action=\"{row}\">\r\n                    <el-button \r\n                        type=\"text\" \r\n                        size=\"mini\" \r\n                        @click=\"showDetail(row)\"\r\n                    >查看详情</el-button>\r\n                </template>\r\n            </PaginationTable>\r\n        </el-card>\r\n\r\n        <!-- 详情弹窗 -->\r\n        <el-dialog \r\n            title=\"投诉详情\" \r\n            :visible.sync=\"detailDialogVisible\" \r\n            width=\"600px\"\r\n            :close-on-click-modal=\"false\"\r\n        >\r\n            <el-form :model=\"currentDetail\" label-width=\"100px\">\r\n                <el-form-item label=\"流水编号\">\r\n                    <span>{{ currentDetail.SId }}</span>\r\n                </el-form-item>\r\n                <el-form-item label=\"投诉内容\">\r\n                    <el-input \r\n                        type=\"textarea\" \r\n                        :rows=\"4\" \r\n                        :value=\"currentDetail.content\" \r\n                        readonly\r\n                    ></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"处理人\">\r\n                    <span>{{ currentDetail.AdminId || '未分配' }}</span>\r\n                </el-form-item>\r\n                <el-form-item label=\"处理状态\">\r\n                    <el-tag \r\n                        :type=\"getStatusType(currentDetail.ComplaintStatus)\"\r\n                        size=\"small\"\r\n                    >\r\n                        {{ getStatusText(currentDetail.ComplaintStatus) }}\r\n                    </el-tag>\r\n                </el-form-item>\r\n                <el-form-item label=\"处理回复\" v-if=\"currentDetail.Response\">\r\n                    <el-input \r\n                        type=\"textarea\" \r\n                        :rows=\"3\" \r\n                        :value=\"currentDetail.Response\" \r\n                        readonly\r\n                    ></el-input>\r\n                </el-form-item>\r\n                <el-form-item v-else label=\"处理回复\">\r\n                    <span>暂无回复</span>\r\n                </el-form-item>\r\n            </el-form>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button size=\"mini\" @click=\"detailDialogVisible = false\">关 闭</el-button>\r\n            </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport store from '@/store';\r\nimport { mapGetters } from 'vuex'\r\n\r\nexport default {\r\n    name: \"ComplaintList\",\r\n    computed: {\r\n        ...mapGetters([\r\n            'Token', 'UserInfo', 'RoleType', 'HasUserInfo', 'ColumnType', \"UserId\"\r\n        ])\r\n    },\r\n    data() {\r\n        return {\r\n            where: {\r\n                UserId: store.getters.UserId\r\n            },\r\n            // 投诉表单数据\r\n            complaintForm: {\r\n                content: ''\r\n            },\r\n            // 表单验证规则\r\n            complaintRules: {\r\n                content: [\r\n                    { required: true, message: '请输入投诉内容', trigger: 'blur' },\r\n                    { min: 10, message: '投诉内容至少10个字符', trigger: 'blur' },\r\n                    { max: 500, message: '投诉内容最多500个字符', trigger: 'blur' }\r\n                ]\r\n            },\r\n            // 表格列定义\r\n            dataColum: [\r\n                {\r\n                    key: \"SId\",\r\n                    title: \"流水编号\",\r\n                    type: store.getters.ColumnType.SHORTTEXT,\r\n                    width: 100\r\n                },\r\n                {\r\n                    key: \"content\",\r\n                    title: \"投诉内容\",\r\n                    type: store.getters.ColumnType.SHORTTEXT,\r\n                    width: 300,\r\n                    formatter: (row, column, cellValue) => {\r\n                        if (!cellValue) return '';\r\n                        return cellValue.length > 30 ? cellValue.substring(0, 30) + '...' : cellValue;\r\n                    }\r\n                },\r\n                {\r\n                    key: \"AdminId\",\r\n                    title: \"处理人\",\r\n                    type: store.getters.ColumnType.SHORTTEXT,\r\n                    width: 100,\r\n                    formatter: (row, column, cellValue) => {\r\n                        return cellValue || '未分配';\r\n                    }\r\n                },\r\n                {\r\n                    key: \"ComplaintStatus\",\r\n                    title: \"处理状态\",\r\n                    type: store.getters.ColumnType.SHORTTEXT,\r\n                    width: 120,\r\n                    formatter: (row, column, cellValue) => {\r\n                        return this.getStatusText(cellValue);\r\n                    }\r\n                },\r\n                {\r\n                    key: \"Response\",\r\n                    title: \"处理回复\",\r\n                    type: store.getters.ColumnType.SHORTTEXT,\r\n                    width: 200,\r\n                    formatter: (row, column, cellValue) => {\r\n                        if (!cellValue) return '暂无回复';\r\n                        return cellValue.length > 20 ? cellValue.substring(0, 20) + '...' : cellValue;\r\n                    }\r\n                }\r\n            ],\r\n            // 详情弹窗控制\r\n            detailDialogVisible: false,\r\n            // 当前查看的详情\r\n            currentDetail: {},\r\n            // 状态映射\r\n            statusMap: {\r\n                0: { text: '待处理', type: 'warning' },\r\n                1: { text: '处理中', type: 'info' },\r\n                2: { text: '已处理', type: 'success' },\r\n                3: { text: '已关闭', type: 'danger' }\r\n            }\r\n        };\r\n    },\r\n    created() {\r\n        // 可以在这里添加初始化逻辑\r\n    },\r\n    methods: {\r\n        // 返回上一个页面\r\n        goBack() {\r\n            this.$router.go(-1)\r\n        },\r\n        \r\n        // 提交投诉\r\n        async submitComplaint() {\r\n            this.$refs.complaintFormRef.validate(async (valid) => {\r\n                if (!valid) {\r\n                    this.$message.error('请填写正确的投诉内容');\r\n                    return;\r\n                }\r\n                \r\n                try {\r\n                    const confirm = await this.$comm.ConfirmMessageBox({ \r\n                        content: \"确认提交投诉吗？提交后不可修改。\" \r\n                    });\r\n                    \r\n                    if (confirm) {\r\n                        // 构建投诉数据\r\n                        const complaintData = {\r\n                            content: this.complaintForm.content\r\n                            // UserId 会自动从Token获取，后端会处理\r\n                        };\r\n                        \r\n                        const { Success, Message } = await this.$Post(\"/Complaint/CreateOrEdit\", complaintData);\r\n                        \r\n                        if (Success) {\r\n                            this.$message.success('投诉提交成功');\r\n                            this.resetComplaintForm();\r\n                            // 刷新表格\r\n                            this.refreshTable();\r\n                        } else {\r\n                            this.$message.error(Message || '提交失败');\r\n                        }\r\n                    }\r\n                } catch (error) {\r\n                    console.error('提交投诉失败:', error);\r\n                    this.$message.error('提交失败，请稍后重试');\r\n                }\r\n            });\r\n        },\r\n        \r\n        // 重置投诉表单\r\n        resetComplaintForm() {\r\n            this.$refs.complaintFormRef.resetFields();\r\n        },\r\n        \r\n        // 刷新表格\r\n        refreshTable() {\r\n            if (this.$refs.ComplaintTable) {\r\n                this.$refs.ComplaintTable.Reload();\r\n            }\r\n        },\r\n        \r\n        // 显示详情弹窗\r\n        async showDetail(row) {\r\n            try {\r\n                // 获取完整详情\r\n                const { Data } = await this.$Post(\"/Complaint/Get\", { \r\n                    Id: row.Id || row.SId \r\n                });\r\n                \r\n                if (Data) {\r\n                    this.currentDetail = Data;\r\n                    this.detailDialogVisible = true;\r\n                } else {\r\n                    this.$message.warning('未找到投诉详情');\r\n                }\r\n            } catch (error) {\r\n                console.error('获取详情失败:', error);\r\n                this.$message.error('获取详情失败');\r\n            }\r\n        },\r\n        \r\n        // 获取状态文本\r\n        getStatusText(status) {\r\n            return this.statusMap[status]?.text || '未知状态';\r\n        },\r\n        \r\n        // 获取状态标签类型\r\n        getStatusType(status) {\r\n            return this.statusMap[status]?.type || 'info';\r\n        }\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.app-container {\r\n    padding: 20px;\r\n}\r\n\r\n.margin-top-lg {\r\n    margin-top: 20px;\r\n}\r\n\r\n.box-card {\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.tb-body {\r\n    padding: 20px;\r\n}\r\n\r\n.el-form-item {\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.clearfix:before,\r\n.clearfix:after {\r\n    display: table;\r\n    content: \"\";\r\n}\r\n\r\n.clearfix:after {\r\n    clear: both;\r\n}\r\n\r\n.dialog-footer {\r\n    text-align: right;\r\n}\r\n\r\n.el-tag {\r\n    margin-right: 10px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}