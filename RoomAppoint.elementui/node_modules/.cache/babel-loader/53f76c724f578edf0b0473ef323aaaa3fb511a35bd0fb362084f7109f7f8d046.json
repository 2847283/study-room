{"ast":null,"code":"import store from '@/store';\nimport { mapGetters } from 'vuex';\nexport default {\n  name: \"ComplaintList\",\n  computed: {\n    ...mapGetters(['Token', 'UserInfo', 'RoleType', 'HasUserInfo', 'ColumnType', \"UserId\"])\n  },\n  data() {\n    return {\n      // 查询条件\n      where: {\n        UserId: store.getters.UserId\n      },\n      // 投诉表单数据\n      complaintForm: {\n        Content: '',\n        UserId: store.getters.UserId,\n        AdminId: 1\n      },\n      // 表单验证规则\n      complaintRules: {\n        Content: [{\n          required: true,\n          message: '请输入投诉内容',\n          trigger: 'blur'\n        }, {\n          min: 10,\n          message: '投诉内容至少10个字符',\n          trigger: 'blur'\n        }]\n      },\n      // 表格列定义 - 简化配置\n      dataColumn: [{\n        key: \"Id\",\n        title: \"流水编号\",\n        width: 100\n      }, {\n        key: \"Content\",\n        title: \"投诉内容\",\n        width: 300,\n        type: store.getters.ColumnType.SHORTTEXT\n      }, {\n        key: \"AdminDto.Name\",\n        title: \"处理人\",\n        width: 130\n      }, {\n        key: \"ComplaintStatusFormat\",\n        title: \"处理状态\",\n        width: 150\n      }, {\n        key: \"Response\",\n        title: \"处理回复\",\n        width: 300,\n        type: store.getters.ColumnType.SHORTTEXT\n      }, {\n        key: \"Operate\",\n        title: \"操作\",\n        width: 100,\n        type: store.getters.ColumnType.USERDEFINED\n      }],\n      // 当前查看的投诉记录\n      currentComplaint: {},\n      // 详情对话框显示状态\n      detailDialogVisible: false,\n      // 提交状态\n      submitting: false\n    };\n  },\n  created() {},\n  methods: {\n    // 返回上一页\n    goBack() {\n      this.$router.go(-1);\n    },\n    // 提交投诉\n    async submitComplaint() {\n      this.$refs.complaintFormRef.validate(async valid => {\n        if (valid) {\n          this.submitting = true;\n          try {\n            // 调用后端接口提交投诉\n            const {\n              Success,\n              Message\n            } = await this.$Post(\"/Complaint/CreateOrEdit\", this.complaintForm);\n            if (Success) {\n              this.$message.success('投诉提交成功！');\n              this.resetComplaintForm();\n              // 刷新投诉记录列表\n              this.$refs.PaginationTableId.Reload();\n            } else {\n              this.$message.error(Message || '提交失败，请稍后重试');\n            }\n          } catch (error) {\n            console.error('提交投诉失败:', error);\n            this.$message.error('提交失败，请稍后重试');\n          } finally {\n            this.submitting = false;\n          }\n        } else {\n          this.$message.warning('请填写完整的投诉信息');\n          return false;\n        }\n      });\n    },\n    // 重置投诉表单\n    resetComplaintForm() {\n      this.$refs.complaintFormRef.resetFields();\n      this.complaintForm.UserId = store.getters.UserId;\n    },\n    // 刷新投诉记录\n    refreshComplaints() {\n      this.$refs.PaginationTableId.Reload();\n    },\n    // 显示投诉详情\n    showDetail(row) {\n      this.currentComplaint = {\n        ...row\n      };\n      this.detailDialogVisible = true;\n    },\n    // 文本截断\n    truncateText(text, length) {\n      if (!text) return '无';\n      if (text.length <= length) return text;\n      return text.substring(0, length) + '...';\n    }\n  }\n};","map":{"version":3,"names":["store","mapGetters","name","computed","data","where","UserId","getters","complaintForm","Content","AdminId","complaintRules","required","message","trigger","min","dataColumn","key","title","width","type","ColumnType","SHORTTEXT","USERDEFINED","currentComplaint","detailDialogVisible","submitting","created","methods","goBack","$router","go","submitComplaint","$refs","complaintFormRef","validate","valid","Success","Message","$Post","$message","success","resetComplaintForm","PaginationTableId","Reload","error","console","warning","resetFields","refreshComplaints","showDetail","row","truncateText","text","length","substring"],"sources":["src/views/Front/ComplaintList.vue"],"sourcesContent":["<template>\r\n    <div class=\"app-container\">\r\n        <el-page-header class=\"card margin-top-lg\" @back=\"goBack\" :content=\"'投诉与反馈'\">\r\n        </el-page-header>\r\n\r\n        <!-- 提交投诉表单 -->\r\n        <el-card class=\"box-card margin-top-lg\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span class=\"card-title\">提交投诉</span>\r\n            </div>\r\n            <div class=\"tb-body\">\r\n                <el-form ref=\"complaintFormRef\" :model=\"complaintForm\" :rules=\"complaintRules\" label-width=\"100px\">\r\n                    <el-form-item label=\"投诉内容\" prop=\"Content\" required>\r\n                        <el-input\r\n                            v-model=\"complaintForm.Content\"\r\n                            type=\"textarea\"\r\n                            :rows=\"4\"\r\n                            placeholder=\"请输入您的投诉内容，我们将尽快处理...\"\r\n                            :maxlength=\"500\"\r\n                            show-word-limit\r\n                        ></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item>\r\n                        <el-button type=\"primary\" @click=\"submitComplaint\" :loading=\"submitting\">提交投诉</el-button>\r\n                        <el-button @click=\"resetComplaintForm\">重置</el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 投诉记录表格 -->\r\n        <el-card class=\"box-card margin-top-lg\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span class=\"card-title\">我的投诉记录</span>\r\n                <el-button type=\"primary\" size=\"mini\" icon=\"el-icon-refresh\" @click=\"refreshComplaints\" style=\"float: right\">刷 新</el-button>\r\n            </div>\r\n            \r\n            <!-- 投诉记录表格部分修改 -->\r\n<PaginationTable \r\n    ref=\"PaginationTableId\" \r\n    url=\"/Complaint/List\" \r\n    :column=\"dataColumn\" \r\n    :where=\"where\"\r\n>\r\n    \r\n    <template v-slot:Operate=\"scope\">\r\n        <el-button type=\"primary\" size=\"mini\" @click=\"showDetail(scope.row)\">查看详情</el-button>\r\n    </template>\r\n</PaginationTable>\r\n        </el-card>\r\n\r\n        <!-- 投诉详情对话框 -->\r\n        <el-dialog \r\n            title=\"投诉详情\" \r\n            :visible.sync=\"detailDialogVisible\" \r\n            width=\"600px\"\r\n            :close-on-click-modal=\"false\"\r\n        >\r\n            <div class=\"complaint-detail\">\r\n                <div class=\"detail-section\">\r\n                    <div class=\"detail-label\">流水编号：</div>\r\n                    <div class=\"detail-value\">{{ currentComplaint.Id }}</div>\r\n                </div>\r\n                \r\n                <div class=\"detail-section\">\r\n                    <div class=\"detail-label\">投诉内容：</div>\r\n                    <div class=\"detail-value detail-content\">{{ currentComplaint.Content || '无' }}</div>\r\n                </div>\r\n                \r\n                <div class=\"detail-section\">\r\n                    <div class=\"detail-label\">处理状态：</div>\r\n                    <div class=\"detail-value detail-content\">{{ currentComplaint.ComplaintStatusFormat}}</div>\r\n                </div>\r\n                \r\n                <div class=\"detail-section\" v-if=\"currentComplaint.AdminDto\">\r\n                    <div class=\"detail-label\">处理人：</div>\r\n                    <div class=\"detail-value\">{{ currentComplaint.AdminDto.Name}}</div>\r\n                </div>\r\n                \r\n                <div class=\"detail-section\" v-if=\"currentComplaint.Response\">\r\n                    <div class=\"detail-label\">处理回复：</div>\r\n                    <div class=\"detail-value detail-content\">{{ currentComplaint.Response }}</div>\r\n                </div>\r\n                \r\n            </div>\r\n            \r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"detailDialogVisible = false\">关 闭</el-button>\r\n            </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport store from '@/store';\r\nimport { mapGetters } from 'vuex'\r\nexport default {\r\n    name: \"ComplaintList\",\r\n    computed: {\r\n        ...mapGetters([\r\n            'Token', 'UserInfo', 'RoleType', 'HasUserInfo', 'ColumnType', \"UserId\"\r\n        ])\r\n    },\r\n    data() {\r\n        return {\r\n            // 查询条件\r\n            where: {\r\n                UserId: store.getters.UserId\r\n            },\r\n            \r\n            // 投诉表单数据\r\n            complaintForm: {\r\n                Content: '',\r\n                UserId: store.getters.UserId,\r\n                AdminId: 1\r\n            },\r\n            \r\n            // 表单验证规则\r\n            complaintRules: {\r\n                Content: [\r\n                    { required: true, message: '请输入投诉内容', trigger: 'blur' },\r\n                    { min: 10, message: '投诉内容至少10个字符', trigger: 'blur' }\r\n                ]\r\n            },\r\n            \r\n            // 表格列定义 - 简化配置\r\n            dataColumn: [\r\n                {\r\n                    key: \"Id\",\r\n                    title: \"流水编号\",\r\n                    width: 100\r\n                },\r\n                {\r\n                    key: \"Content\",\r\n                    title: \"投诉内容\",\r\n                    width: 300,\r\n                    type: store.getters.ColumnType.SHORTTEXT,\r\n                },\r\n                {\r\n                    key: \"AdminDto.Name\",\r\n                    title: \"处理人\",\r\n                    width: 130\r\n                },\r\n                {\r\n                    key: \"ComplaintStatusFormat\",\r\n                    title: \"处理状态\",\r\n                    width: 150,\r\n                },\r\n                {\r\n                    key: \"Response\",\r\n                    title: \"处理回复\",\r\n                    width: 300,\r\n                    type: store.getters.ColumnType.SHORTTEXT,\r\n                },\r\n                {\r\n                    key: \"Operate\",\r\n                    title: \"操作\",\r\n                    width: 100,\r\n                    type: store.getters.ColumnType.USERDEFINED,\r\n                }\r\n            ],\r\n            \r\n            \r\n            // 当前查看的投诉记录\r\n            currentComplaint: {},\r\n            \r\n            // 详情对话框显示状态\r\n            detailDialogVisible: false,\r\n            \r\n            // 提交状态\r\n            submitting: false\r\n        };\r\n    },\r\n    created() {\r\n    },\r\n    methods: {\r\n        // 返回上一页\r\n        goBack() {\r\n            this.$router.go(-1)\r\n        },\r\n        // 提交投诉\r\n        async submitComplaint() {\r\n            this.$refs.complaintFormRef.validate(async (valid) => {\r\n                if (valid) {\r\n                    this.submitting = true;\r\n                    try {\r\n                        // 调用后端接口提交投诉\r\n                        const { Success, Message } = await this.$Post(\"/Complaint/CreateOrEdit\", this.complaintForm);\r\n                        \r\n                        if (Success) {\r\n                            this.$message.success('投诉提交成功！');\r\n                            this.resetComplaintForm();\r\n                            // 刷新投诉记录列表\r\n                            this.$refs.PaginationTableId.Reload();\r\n                        } else {\r\n                            this.$message.error(Message || '提交失败，请稍后重试');\r\n                        }\r\n                    } catch (error) {\r\n                        console.error('提交投诉失败:', error);\r\n                        this.$message.error('提交失败，请稍后重试');\r\n                    } finally {\r\n                        this.submitting = false;\r\n                    }\r\n                } else {\r\n                    this.$message.warning('请填写完整的投诉信息');\r\n                    return false;\r\n                }\r\n            });\r\n        },\r\n        \r\n        // 重置投诉表单\r\n        resetComplaintForm() {\r\n            this.$refs.complaintFormRef.resetFields();\r\n            this.complaintForm.UserId = store.getters.UserId;\r\n        },\r\n        \r\n        // 刷新投诉记录\r\n        refreshComplaints() {\r\n            this.$refs.PaginationTableId.Reload();\r\n        },\r\n        \r\n        \r\n        // 显示投诉详情\r\n        showDetail(row) {\r\n            this.currentComplaint = { ...row };\r\n            this.detailDialogVisible = true;\r\n        },\r\n        \r\n        // 文本截断\r\n        truncateText(text, length) {\r\n            if (!text) return '无';\r\n            if (text.length <= length) return text;\r\n            return text.substring(0, length) + '...';\r\n        },\r\n        \r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.app-container {\r\n    padding: 20px;\r\n}\r\n\r\n.margin-top-lg {\r\n    margin-top: 20px;\r\n}\r\n\r\n.card-title {\r\n    font-size: 16px;\r\n    font-weight: bold;\r\n    color: #303133;\r\n}\r\n\r\n.tb-body {\r\n    padding: 10px 0;\r\n}\r\n\r\n.table-summary {\r\n    padding: 8px 0;\r\n    font-size: 14px;\r\n    color: #606266;\r\n}\r\n\r\n.highlight {\r\n    color: #409EFF;\r\n    font-weight: bold;\r\n}\r\n\r\n.complaint-detail {\r\n    padding: 0 10px;\r\n}\r\n\r\n.detail-section {\r\n    display: flex;\r\n    margin-bottom: 16px;\r\n    line-height: 1.5;\r\n}\r\n\r\n.detail-label {\r\n    width: 100px;\r\n    font-weight: bold;\r\n    color: #606266;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.detail-value {\r\n    flex: 1;\r\n    color: #303133;\r\n    word-break: break-word;\r\n}\r\n\r\n.detail-content {\r\n    background-color: #f5f7fa;\r\n    padding: 10px;\r\n    border-radius: 4px;\r\n    border-left: 3px solid #409EFF;\r\n}\r\n\r\n.clearfix:before,\r\n.clearfix:after {\r\n    display: table;\r\n    content: \"\";\r\n}\r\n\r\n.clearfix:after {\r\n    clear: both;\r\n}\r\n\r\n.box-card {\r\n    border-radius: 8px;\r\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.el-page-header {\r\n    background-color: #fff;\r\n    padding: 20px;\r\n    border-radius: 8px;\r\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n</style>"],"mappings":"AA8FA,OAAAA,KAAA;AACA,SAAAC,UAAA;AACA;EACAC,IAAA;EACAC,QAAA;IACA,GAAAF,UAAA,EACA,uEACA;EACA;EACAG,KAAA;IACA;MACA;MACAC,KAAA;QACAC,MAAA,EAAAN,KAAA,CAAAO,OAAA,CAAAD;MACA;MAEA;MACAE,aAAA;QACAC,OAAA;QACAH,MAAA,EAAAN,KAAA,CAAAO,OAAA,CAAAD,MAAA;QACAI,OAAA;MACA;MAEA;MACAC,cAAA;QACAF,OAAA,GACA;UAAAG,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,GAAA;UAAAF,OAAA;UAAAC,OAAA;QAAA;MAEA;MAEA;MACAE,UAAA,GACA;QACAC,GAAA;QACAC,KAAA;QACAC,KAAA;MACA,GACA;QACAF,GAAA;QACAC,KAAA;QACAC,KAAA;QACAC,IAAA,EAAApB,KAAA,CAAAO,OAAA,CAAAc,UAAA,CAAAC;MACA,GACA;QACAL,GAAA;QACAC,KAAA;QACAC,KAAA;MACA,GACA;QACAF,GAAA;QACAC,KAAA;QACAC,KAAA;MACA,GACA;QACAF,GAAA;QACAC,KAAA;QACAC,KAAA;QACAC,IAAA,EAAApB,KAAA,CAAAO,OAAA,CAAAc,UAAA,CAAAC;MACA,GACA;QACAL,GAAA;QACAC,KAAA;QACAC,KAAA;QACAC,IAAA,EAAApB,KAAA,CAAAO,OAAA,CAAAc,UAAA,CAAAE;MACA,EACA;MAGA;MACAC,gBAAA;MAEA;MACAC,mBAAA;MAEA;MACAC,UAAA;IACA;EACA;EACAC,QAAA,GACA;EACAC,OAAA;IACA;IACAC,OAAA;MACA,KAAAC,OAAA,CAAAC,EAAA;IACA;IACA;IACA,MAAAC,gBAAA;MACA,KAAAC,KAAA,CAAAC,gBAAA,CAAAC,QAAA,OAAAC,KAAA;QACA,IAAAA,KAAA;UACA,KAAAV,UAAA;UACA;YACA;YACA;cAAAW,OAAA;cAAAC;YAAA,eAAAC,KAAA,iCAAA/B,aAAA;YAEA,IAAA6B,OAAA;cACA,KAAAG,QAAA,CAAAC,OAAA;cACA,KAAAC,kBAAA;cACA;cACA,KAAAT,KAAA,CAAAU,iBAAA,CAAAC,MAAA;YACA;cACA,KAAAJ,QAAA,CAAAK,KAAA,CAAAP,OAAA;YACA;UACA,SAAAO,KAAA;YACAC,OAAA,CAAAD,KAAA,YAAAA,KAAA;YACA,KAAAL,QAAA,CAAAK,KAAA;UACA;YACA,KAAAnB,UAAA;UACA;QACA;UACA,KAAAc,QAAA,CAAAO,OAAA;UACA;QACA;MACA;IACA;IAEA;IACAL,mBAAA;MACA,KAAAT,KAAA,CAAAC,gBAAA,CAAAc,WAAA;MACA,KAAAxC,aAAA,CAAAF,MAAA,GAAAN,KAAA,CAAAO,OAAA,CAAAD,MAAA;IACA;IAEA;IACA2C,kBAAA;MACA,KAAAhB,KAAA,CAAAU,iBAAA,CAAAC,MAAA;IACA;IAGA;IACAM,WAAAC,GAAA;MACA,KAAA3B,gBAAA;QAAA,GAAA2B;MAAA;MACA,KAAA1B,mBAAA;IACA;IAEA;IACA2B,aAAAC,IAAA,EAAAC,MAAA;MACA,KAAAD,IAAA;MACA,IAAAA,IAAA,CAAAC,MAAA,IAAAA,MAAA,SAAAD,IAAA;MACA,OAAAA,IAAA,CAAAE,SAAA,IAAAD,MAAA;IACA;EAEA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}