{"ast":null,"code":"import { mapGetters } from 'vuex';\nexport default {\n  name: \"ComplaintList\",\n  computed: {\n    ...mapGetters(['Token', 'UserInfo', 'UserId'])\n  },\n  data() {\n    return {\n      complaintForm: {\n        content: ''\n      },\n      submitting: false,\n      loading: false,\n      complaintList: [],\n      pagination: {\n        currentPage: 1,\n        pageSize: 10,\n        total: 0\n      },\n      detailDialogVisible: false,\n      currentComplaint: null\n    };\n  },\n  created() {\n    this.loadComplaintList();\n  },\n  methods: {\n    goBack() {\n      this.$router.go(-1);\n    },\n    async submitComplaint() {\n      if (!this.complaintForm.content.trim()) {\n        this.$message.warning('请输入投诉内容');\n        return;\n      }\n      this.submitting = true;\n      try {\n        // 先使用简单的 POST 请求，避免使用 this.$Post 可能的问题\n        const response = await this.$http.post('/Complaint/Create', {\n          ...this.complaintForm,\n          UserId: this.UserId\n        });\n        if (response.data && response.data.Success) {\n          this.$message.success('投诉提交成功！');\n          this.resetForm();\n          this.loadComplaintList(); // 重新加载列表\n        } else {\n          this.$message.error(response.data.Message || '提交失败');\n        }\n      } catch (error) {\n        console.error('提交失败:', error);\n        this.$message.error('提交失败，请重试');\n      } finally {\n        this.submitting = false;\n      }\n    },\n    resetForm() {\n      this.complaintForm.content = '';\n    },\n    async loadComplaintList() {\n      this.loading = true;\n      try {\n        // 直接使用 axios 实例，避免潜在的问题\n        const response = await this.$http.post('/Complaint/List', {\n          UserId: this.UserId,\n          page: this.pagination.currentPage,\n          pageSize: this.pagination.pageSize\n        });\n        if (response.data && response.data.Success) {\n          // 假设接口返回 { Success, Data: { items, total } }\n          this.complaintList = response.data.Data.items || response.data.Data || [];\n          this.pagination.total = response.data.Data.total || this.complaintList.length;\n\n          // 如果数据为空，显示提示\n          if (this.complaintList.length === 0) {\n            this.$message.info('暂无投诉记录');\n          }\n        } else {\n          this.$message.error(response.data.Message || '加载失败');\n          this.complaintList = [];\n        }\n      } catch (error) {\n        console.error('加载投诉列表失败:', error);\n        this.$message.error('加载失败，请检查网络或联系管理员');\n        this.complaintList = [];\n      } finally {\n        this.loading = false;\n      }\n    },\n    viewDetail(row) {\n      this.currentComplaint = row;\n      this.detailDialogVisible = true;\n    },\n    getStatusType(status) {\n      if (!status) return 'info';\n      const statusMap = {\n        '待处理': 'warning',\n        '处理中': 'info',\n        '已处理': 'success',\n        '已关闭': 'danger'\n      };\n      return statusMap[status] || 'info';\n    },\n    handleSizeChange(val) {\n      this.pagination.pageSize = val;\n      this.loadComplaintList();\n    },\n    handleCurrentChange(val) {\n      this.pagination.currentPage = val;\n      this.loadComplaintList();\n    }\n  }\n};","map":{"version":3,"names":["mapGetters","name","computed","data","complaintForm","content","submitting","loading","complaintList","pagination","currentPage","pageSize","total","detailDialogVisible","currentComplaint","created","loadComplaintList","methods","goBack","$router","go","submitComplaint","trim","$message","warning","response","$http","post","UserId","Success","success","resetForm","error","Message","console","page","Data","items","length","info","viewDetail","row","getStatusType","status","statusMap","handleSizeChange","val","handleCurrentChange"],"sources":["src/views/Front/ComplaintList.vue"],"sourcesContent":["<template>\r\n    <div class=\"app-container\">\r\n        <el-page-header class=\"card margin-top-lg\" @back=\"goBack\" content=\"投诉建议\"></el-page-header>\r\n\r\n        <!-- 投诉输入区域 -->\r\n        <el-card class=\"box-card margin-top-lg\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>我要投诉</span>\r\n            </div>\r\n            <div class=\"tb-body\">\r\n                <el-form ref=\"complaintFormRef\" :model=\"complaintForm\">\r\n                    <el-form-item prop=\"content\">\r\n                        <el-input \r\n                            type=\"textarea\" \r\n                            :rows=\"4\" \r\n                            v-model=\"complaintForm.content\" \r\n                            placeholder=\"请输入您的投诉内容...\" \r\n                            maxlength=\"500\"\r\n                            show-word-limit\r\n                        ></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item>\r\n                        <el-button type=\"primary\" size=\"mini\" @click=\"submitComplaint\" :loading=\"submitting\">\r\n                            提交投诉\r\n                        </el-button>\r\n                        <el-button type=\"warning\" size=\"mini\" @click=\"resetForm\">清空</el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 投诉记录列表 -->\r\n        <!-- 先不使用 PaginationTable，用原生 el-table 测试 -->\r\n        <el-card class=\"box-card margin-top-lg\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>投诉记录</span>\r\n                <el-button \r\n                    type=\"primary\" \r\n                    size=\"mini\" \r\n                    icon=\"el-icon-refresh\" \r\n                    @click=\"loadComplaintList\"\r\n                    style=\"float: right;\"\r\n                >\r\n                    刷新\r\n                </el-button>\r\n            </div>\r\n            \r\n            <el-table\r\n                :data=\"complaintList\"\r\n                style=\"width: 100%\"\r\n                v-loading=\"loading\"\r\n                @row-click=\"viewDetail\"\r\n            >\r\n                <el-table-column\r\n                    prop=\"time\"\r\n                    label=\"投诉时间\"\r\n                    width=\"180\"\r\n                    align=\"center\"\r\n                ></el-table-column>\r\n                \r\n                <el-table-column\r\n                    prop=\"content\"\r\n                    label=\"投诉内容\"\r\n                    min-width=\"300\"\r\n                >\r\n                    <template slot-scope=\"scope\">\r\n                        {{ scope.row.content ? (scope.row.content.length > 50 ? scope.row.content.substring(0, 50) + '...' : scope.row.content) : '' }}\r\n                    </template>\r\n                </el-table-column>\r\n                \r\n                <el-table-column\r\n                    prop=\"handler\"\r\n                    label=\"处理人\"\r\n                    width=\"120\"\r\n                    align=\"center\"\r\n                >\r\n                    <template slot-scope=\"scope\">\r\n                        <span v-if=\"scope.row.handler\">{{ scope.row.handler }}</span>\r\n                        <span v-else style=\"color: #909399;\">未分配</span>\r\n                    </template>\r\n                </el-table-column>\r\n                \r\n                <el-table-column\r\n                    prop=\"status\"\r\n                    label=\"处理状态\"\r\n                    width=\"120\"\r\n                    align=\"center\"\r\n                >\r\n                    <template slot-scope=\"scope\">\r\n                        <el-tag :type=\"getStatusType(scope.row.status)\" size=\"small\">\r\n                            {{ scope.row.status || '未知' }}\r\n                        </el-tag>\r\n                    </template>\r\n                </el-table-column>\r\n                \r\n                <el-table-column\r\n                    label=\"操作\"\r\n                    width=\"100\"\r\n                    align=\"center\"\r\n                >\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"text\" size=\"small\" @click.stop=\"viewDetail(scope.row)\">查看详情</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n            \r\n            <!-- 简单分页 -->\r\n            <div class=\"pagination-container\" style=\"margin-top: 20px; text-align: right;\">\r\n                <el-pagination\r\n                    @size-change=\"handleSizeChange\"\r\n                    @current-change=\"handleCurrentChange\"\r\n                    :current-page=\"pagination.currentPage\"\r\n                    :page-sizes=\"[10, 20, 50]\"\r\n                    :page-size=\"pagination.pageSize\"\r\n                    layout=\"total, sizes, prev, pager, next, jumper\"\r\n                    :total=\"pagination.total\"\r\n                ></el-pagination>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 详情弹窗 -->\r\n        <el-dialog\r\n            title=\"投诉详情\"\r\n            :visible.sync=\"detailDialogVisible\"\r\n            width=\"600px\"\r\n            center\r\n        >\r\n            <div class=\"complaint-detail\">\r\n                <template v-if=\"currentComplaint\">\r\n                    <el-descriptions :column=\"1\" border>\r\n                        <el-descriptions-item label=\"投诉时间\">{{ currentComplaint.time || '暂无' }}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"投诉内容\">\r\n                            <div class=\"detail-content\">{{ currentComplaint.content || '暂无' }}</div>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"处理人\">\r\n                            <span v-if=\"currentComplaint.handler\">{{ currentComplaint.handler }}</span>\r\n                            <span v-else style=\"color: #909399;\">未分配</span>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"处理状态\">\r\n                            <el-tag :type=\"getStatusType(currentComplaint.status)\" size=\"medium\">\r\n                                {{ currentComplaint.status || '未知' }}\r\n                            </el-tag>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"处理结果\" v-if=\"currentComplaint.result\">\r\n                            <div class=\"detail-result\">{{ currentComplaint.result }}</div>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"处理时间\" v-if=\"currentComplaint.handleTime\">\r\n                            {{ currentComplaint.handleTime }}\r\n                        </el-descriptions-item>\r\n                    </el-descriptions>\r\n                </template>\r\n                <div v-else style=\"text-align: center; padding: 40px;\">\r\n                    暂无数据\r\n                </div>\r\n            </div>\r\n            \r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"detailDialogVisible = false\">关闭</el-button>\r\n            </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex'\r\n\r\nexport default {\r\n    name: \"ComplaintList\",\r\n    computed: {\r\n        ...mapGetters(['Token', 'UserInfo', 'UserId'])\r\n    },\r\n    data() {\r\n        return {\r\n            complaintForm: {\r\n                content: ''\r\n            },\r\n            submitting: false,\r\n            loading: false,\r\n            complaintList: [],\r\n            pagination: {\r\n                currentPage: 1,\r\n                pageSize: 10,\r\n                total: 0\r\n            },\r\n            detailDialogVisible: false,\r\n            currentComplaint: null\r\n        }\r\n    },\r\n    created() {\r\n        this.loadComplaintList();\r\n    },\r\n    methods: {\r\n        goBack() {\r\n            this.$router.go(-1);\r\n        },\r\n        \r\n        async submitComplaint() {\r\n            if (!this.complaintForm.content.trim()) {\r\n                this.$message.warning('请输入投诉内容');\r\n                return;\r\n            }\r\n            \r\n            this.submitting = true;\r\n            try {\r\n                // 先使用简单的 POST 请求，避免使用 this.$Post 可能的问题\r\n                const response = await this.$http.post('/Complaint/Create', {\r\n                    ...this.complaintForm,\r\n                    UserId: this.UserId\r\n                });\r\n                \r\n                if (response.data && response.data.Success) {\r\n                    this.$message.success('投诉提交成功！');\r\n                    this.resetForm();\r\n                    this.loadComplaintList(); // 重新加载列表\r\n                } else {\r\n                    this.$message.error(response.data.Message || '提交失败');\r\n                }\r\n            } catch (error) {\r\n                console.error('提交失败:', error);\r\n                this.$message.error('提交失败，请重试');\r\n            } finally {\r\n                this.submitting = false;\r\n            }\r\n        },\r\n        \r\n        resetForm() {\r\n            this.complaintForm.content = '';\r\n        },\r\n        \r\n        async loadComplaintList() {\r\n            this.loading = true;\r\n            try {\r\n                // 直接使用 axios 实例，避免潜在的问题\r\n                const response = await this.$http.post('/Complaint/List', {\r\n                    UserId: this.UserId,\r\n                    page: this.pagination.currentPage,\r\n                    pageSize: this.pagination.pageSize\r\n                });\r\n                \r\n                if (response.data && response.data.Success) {\r\n                    // 假设接口返回 { Success, Data: { items, total } }\r\n                    this.complaintList = response.data.Data.items || response.data.Data || [];\r\n                    this.pagination.total = response.data.Data.total || this.complaintList.length;\r\n                    \r\n                    // 如果数据为空，显示提示\r\n                    if (this.complaintList.length === 0) {\r\n                        this.$message.info('暂无投诉记录');\r\n                    }\r\n                } else {\r\n                    this.$message.error(response.data.Message || '加载失败');\r\n                    this.complaintList = [];\r\n                }\r\n            } catch (error) {\r\n                console.error('加载投诉列表失败:', error);\r\n                this.$message.error('加载失败，请检查网络或联系管理员');\r\n                this.complaintList = [];\r\n            } finally {\r\n                this.loading = false;\r\n            }\r\n        },\r\n        \r\n        viewDetail(row) {\r\n            this.currentComplaint = row;\r\n            this.detailDialogVisible = true;\r\n        },\r\n        \r\n        getStatusType(status) {\r\n            if (!status) return 'info';\r\n            \r\n            const statusMap = {\r\n                '待处理': 'warning',\r\n                '处理中': 'info',\r\n                '已处理': 'success',\r\n                '已关闭': 'danger'\r\n            };\r\n            return statusMap[status] || 'info';\r\n        },\r\n        \r\n        handleSizeChange(val) {\r\n            this.pagination.pageSize = val;\r\n            this.loadComplaintList();\r\n        },\r\n        \r\n        handleCurrentChange(val) {\r\n            this.pagination.currentPage = val;\r\n            this.loadComplaintList();\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.app-container {\r\n    padding: 20px;\r\n}\r\n\r\n.card,\r\n.box-card {\r\n    margin-bottom: 16px;\r\n}\r\n\r\n.detail-content,\r\n.detail-result {\r\n    line-height: 1.6;\r\n    padding: 8px;\r\n    background-color: #f5f7fa;\r\n    border-radius: 4px;\r\n    word-break: break-word;\r\n}\r\n\r\n.margin-top-lg {\r\n    margin-top: 16px;\r\n}\r\n\r\n.clearfix:before,\r\n.clearfix:after {\r\n    display: table;\r\n    content: \"\";\r\n}\r\n.clearfix:after {\r\n    clear: both;\r\n}\r\n</style>"],"mappings":"AAoKA,SAAAA,UAAA;AAEA;EACAC,IAAA;EACAC,QAAA;IACA,GAAAF,UAAA;EACA;EACAG,KAAA;IACA;MACAC,aAAA;QACAC,OAAA;MACA;MACAC,UAAA;MACAC,OAAA;MACAC,aAAA;MACAC,UAAA;QACAC,WAAA;QACAC,QAAA;QACAC,KAAA;MACA;MACAC,mBAAA;MACAC,gBAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,iBAAA;EACA;EACAC,OAAA;IACAC,OAAA;MACA,KAAAC,OAAA,CAAAC,EAAA;IACA;IAEA,MAAAC,gBAAA;MACA,UAAAjB,aAAA,CAAAC,OAAA,CAAAiB,IAAA;QACA,KAAAC,QAAA,CAAAC,OAAA;QACA;MACA;MAEA,KAAAlB,UAAA;MACA;QACA;QACA,MAAAmB,QAAA,cAAAC,KAAA,CAAAC,IAAA;UACA,QAAAvB,aAAA;UACAwB,MAAA,OAAAA;QACA;QAEA,IAAAH,QAAA,CAAAtB,IAAA,IAAAsB,QAAA,CAAAtB,IAAA,CAAA0B,OAAA;UACA,KAAAN,QAAA,CAAAO,OAAA;UACA,KAAAC,SAAA;UACA,KAAAf,iBAAA;QACA;UACA,KAAAO,QAAA,CAAAS,KAAA,CAAAP,QAAA,CAAAtB,IAAA,CAAA8B,OAAA;QACA;MACA,SAAAD,KAAA;QACAE,OAAA,CAAAF,KAAA,UAAAA,KAAA;QACA,KAAAT,QAAA,CAAAS,KAAA;MACA;QACA,KAAA1B,UAAA;MACA;IACA;IAEAyB,UAAA;MACA,KAAA3B,aAAA,CAAAC,OAAA;IACA;IAEA,MAAAW,kBAAA;MACA,KAAAT,OAAA;MACA;QACA;QACA,MAAAkB,QAAA,cAAAC,KAAA,CAAAC,IAAA;UACAC,MAAA,OAAAA,MAAA;UACAO,IAAA,OAAA1B,UAAA,CAAAC,WAAA;UACAC,QAAA,OAAAF,UAAA,CAAAE;QACA;QAEA,IAAAc,QAAA,CAAAtB,IAAA,IAAAsB,QAAA,CAAAtB,IAAA,CAAA0B,OAAA;UACA;UACA,KAAArB,aAAA,GAAAiB,QAAA,CAAAtB,IAAA,CAAAiC,IAAA,CAAAC,KAAA,IAAAZ,QAAA,CAAAtB,IAAA,CAAAiC,IAAA;UACA,KAAA3B,UAAA,CAAAG,KAAA,GAAAa,QAAA,CAAAtB,IAAA,CAAAiC,IAAA,CAAAxB,KAAA,SAAAJ,aAAA,CAAA8B,MAAA;;UAEA;UACA,SAAA9B,aAAA,CAAA8B,MAAA;YACA,KAAAf,QAAA,CAAAgB,IAAA;UACA;QACA;UACA,KAAAhB,QAAA,CAAAS,KAAA,CAAAP,QAAA,CAAAtB,IAAA,CAAA8B,OAAA;UACA,KAAAzB,aAAA;QACA;MACA,SAAAwB,KAAA;QACAE,OAAA,CAAAF,KAAA,cAAAA,KAAA;QACA,KAAAT,QAAA,CAAAS,KAAA;QACA,KAAAxB,aAAA;MACA;QACA,KAAAD,OAAA;MACA;IACA;IAEAiC,WAAAC,GAAA;MACA,KAAA3B,gBAAA,GAAA2B,GAAA;MACA,KAAA5B,mBAAA;IACA;IAEA6B,cAAAC,MAAA;MACA,KAAAA,MAAA;MAEA,MAAAC,SAAA;QACA;QACA;QACA;QACA;MACA;MACA,OAAAA,SAAA,CAAAD,MAAA;IACA;IAEAE,iBAAAC,GAAA;MACA,KAAArC,UAAA,CAAAE,QAAA,GAAAmC,GAAA;MACA,KAAA9B,iBAAA;IACA;IAEA+B,oBAAAD,GAAA;MACA,KAAArC,UAAA,CAAAC,WAAA,GAAAoC,GAAA;MACA,KAAA9B,iBAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}